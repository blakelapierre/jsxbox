<html>
  <head>
    <title>mathbox/jsx</title>
  </head>
  <body>
    <script src="handler.js"></script>
    <script src="mathbox-bundle.js"></script>

    <script type="mathbox/jsx">
      <root>
        <cartesian range={[[-1, 1], [-1, 1], [-1, 1]]} scale={[1, 1, 1]}>
          <present index={1}>
            <slide>
              <reveal duration={2}>
                <transform position={[0, 1, 0]} scale={[11/10, 11/10, 11/10]}>
                  <step script={[[{position: [0, 1, 0]}], [{position: [0, 3/4, 0]}], [{position: [0, 1/2, 0]}], [{position: [0, 1/4, 0]}], [{position: [0, 0, 0]}], [{position: [0, -1/4, 0]}], [{position: [0, -1/2, 0]}], [{position: [0, -3/4, 0]}], [{position: [0, -1, 0]}]]} />
                  <grid axes={[1, 3]} width={2} color={11579568} depth={1/2} />
                </transform>
              </reveal>
              <slide>
                <reveal stagger={[1, 1, 0, 0]}>
                  <transform position={[0, 3/4, 0]}>
                    <grid axes={[1, 3]} width={2} color={3145616} depth={1/2} />
                  </transform>
                </reveal>
              </slide>
              <slide>
                <reveal>
                  <move from={[1, 0, 0, 0]}>
                    <transform position={[0, 1/2, 0]}>
                      <grid axes={[1, 3]} width={2} color={3121136} depth={1/2} />
                    </transform>
                  </move>
                  <slide>
                    <reveal stagger={1}>
                      <move stagger={1} to={[0, -1, 0, 0]}>
                        <transform position={[0, 1/4, 0]}>
                          <grid detailX={20} detailY={20} axes={[1, 3]} width={2} color={3121136} depth={1/2} />
                        </transform>
                      </move>
                    </reveal>
                  </slide>
                </reveal>
              </slide>
            </slide>
            <slide>
              <grid axes={[1, 3]} width={2} color={16732048} depth={1/2} />
              <reveal stagger={[1]} duration={1}>
                <interval length={128} expr={(emit, x, i, t) => {
                    if (i == 0) console.log('emitting')
                    emit(x, .5 + .5 * Math.sin((x + t) * 3));
                  }} channels={2} />
                <line color={3182847} width={20} />
              </reveal>
            </slide>
            <slide>
              <reveal>
                <transform position={[0, -1/4, 0]}>
                  <grid axes={[1, 3]} width={2} color={16723856} depth={1/2} />
                </transform>
              </reveal>
              <slide>
                <reveal>
                  <move stagger={2} from={[0, -2, 0, 0]} to={[0, -2, 0, 0]}>
                    <transform position={[0, -1/2, 0]}>
                      <grid detailX={20} detailY={20} axes={[1, 3]} width={2} color={10432496} depth={1/2} crossed={true} />
                    </transform>
                  </move>
                </reveal>
              </slide>
              <slide early={1} late={1}>
                <reveal>
                  <transform position={[0, -3/4, 0]}>
                    <grid axes={[1, 3]} width={2} color={10432496} depth={1/2} />
                  </transform>
                </reveal>
              </slide>
              <slide>
                <reveal>
                  <transform position={[0, -1, 0]}>
                    <grid axes={[1, 3]} width={2} color={10432496} depth={1/2} />
                  </transform>
                </reveal>
              </slide>
            </slide>
          </present>
          <camera lookAt={[0, 0, 0]} position={t => [-3 * Math.cos(t), .4 + .2 * Math.cos(t * .381), -3 * Math.sin(t)]} />
        </cartesian>
      </root>

      window.onkeydown = function (e) {
        const present = view.select('present'),
              index = present.get('index'),
              length = present.get('length');

        switch (e.keyCode) {
          case 37:
          case 38:
            present.set('index', (index - 1) % length);
            break;
          case 39:
          case 40:
            present.set('index', (index + 1) % length);
            break;
        }
      }
    </script>
  </body>
</html>
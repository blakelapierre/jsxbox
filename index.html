<html>
  <head>
    <title>mathbox/jsx</title>

    <style>
    body {
      margin: 0;
      padding: 0;

      display: flex;

      overflow: hidden;
    }
    </style>

    <style>
    .box {
      position: relative;

      display: flex;

      flex: 1;
    }

    .box mathbox {
      flex: 1;
    }

    .box .settings {
      position: absolute;
      top: 0;
      right: 0;

      color: #fff;

      cursor: pointer;

      user-select: none;
    }
    </style>

    <style>
      .box .panel {
        display: none;
        flex: 1;
      }

      .box.settings .panel {
        display: block;
      }

      .editor-panel {
        position: absolute;

        top: 0;
        left: 0;

        bottom: 0;
        right: 0;

        width: 100%;

        background: none;

        color: #fff;

        white-space: pre-wrap;
        font-family: monospace;

        overflow: auto;

        cursor: text;
      }
    </style>
  </head>
  <body>
    <script src="handler.js"></script>
    <script src="mathbox-bundle.js"></script>

    <div class="box">
      <mathbox tabindex="2">
        <script type="mathbox/jsx">
        const data = [],
              x_min = 1, x_max = 512,
              y_min = 1, y_max = 32,
              z_min = 0, z_max = 15;

        for (let x = x_min; x < x_max; x++)
          for (let y = y_min; y < y_max; y++)
            for (let z = z_min; z < z_max; z++)
              if (x !== 0 && y !== 0 && x % y === z) data.push([x, y, z, Math.pow(x, z) + Math.pow(y,z) + Math.pow(z,z)]);

        <root>
            <camera
              proxy={true}
              lookAt={[-5, 0, 5, 0]}
              position={t=>[0, 0, 5 + (Math.sin(t / 4) + 1) * 10]}
              fov={100}
            />

            <polar
              range={[[x_min, x_max], [y_min, y_max], [z_min, Math.pow(z_max, z_max)], [-1, 1]]}
              scale={[16/9, 1, 1, 1]}
              position={[-5, 0, 5, 0]}
              bend={t=> (Math.sin(t / 5) + 1) / 3}
              helix={t=> (Math.sin(t / 7) + 1) / 3}
              rotation={t => [t / 3, -t / 7, t / 5]}
            >
              <array length={data.length} channels={4} data={data} />
              <swizzle order={'yxwz'} />
              <point size={5} color={[64 / 255, 128 / 255, 192 / 255]} blending={'add'} shape={'square'}/>
            </polar>

        </root>

        module.exports = {
          editorPanel: false
        };
        </script>
      </mathbox>
      <div class="panel"></div>
      <div class="settings" onclick="expandPanel(event, this)">P</div>
    </div>

    <script>
      function expandPanel(event, settings) {
        var box = settings.parentElement,
            panel = box.getElementsByClassName('panel')[0],
            canvas = box.getElementsByTagName('canvas')[0];

        if (box.classList.contains('settings')) box.classList.remove('settings');
        else box.classList.add('settings');

        canvas.style.width = '100%';
      }
    </script>
  </body>
</html>
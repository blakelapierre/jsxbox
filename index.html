<html>
  <head>
    <title>mathbox/jsx</title>

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@BlakeLaPierre" />
    <meta name="twitter:title" content="MathBox^2 Scenes Using JSX" />
    <meta name="twitter:description" content="Create, share, and view MathBox^2 scenes using JSX" />
    <meta name="twitter:image" content="https://blakelapierre.github.io/jsxbox/images/282x278.png" />
    <meta name="og:image" content="https://blakelapierre.github.io/jsxbox/images/282x278.png" />

    <script>less = {async: true}; //wot</script>

    <style type="text/less">
    body {
      height: 100%;

      margin: 0;
      padding: 0;

      display: flex;

      overflow: hidden;
    }

    textarea.link-box {
      display: none;
      position: fixed;

      top: 25%;
      left: 12.5%;
      width: 75%;
      height: 50%;

      margin: 0 auto;

      background-color: #fff;
      color: #000;

      &.show {
        display: block;
      }
    }

    mathbox {
      display: flex;

      flex: 1 1 auto;

      height: 100%;

      &.has-editor-panel {
        mathbox-container {
          width: 50%;
        }
      }

      mathbox-container {
        width: 100%;
      }

      panel {
        display: flex;

        flex: 1 1 auto;

        // min-width: 50%;

        history {
          flex: 0 1 auto;

          background-color: white;
          color: black;

          overflow-y: auto;

          history-element {
            display: flex;
            flex-direction: column;

            cursor: pointer;

            &.had-error {
              background-color: red;
            }

            &:hover {
              background-color: #999;
            }

            info {
              display: block;
              text-align: center;
            }

            render-surface {
              display: block;

              overflow: hidden;

              transform: scale(0.9);

              white-space: pre-wrap;
              font-family: monospace;

              font-size: 0.5em;

              img {
                width: 100%;
              }
            }
          }
        }

        edit-panel {
          flex: 1 1 auto;

          display: flex;
          flex-direction: column;

          overflow: auto;

          &.after {
            order: 1;
          }

          &.has-error {
            error-area {
              display: block;

            }
          }

          textarea {
            flex: 1 1 auto;

            min-height: 2em;

            background: #000;

            border: none;

            color: #fff;

            white-space: pre-wrap;
            font-family: monospace;

            overflow: visible;

            cursor: text;

            transition: all 0.25s ease-in-out;
          }

          error-area {
            display: none;

            flex: 0 0 auto;

            width: 100%;

            overflow: auto;

            white-space: pre-wrap;
            font-family: monospace;

            background-color: #cc6666;

            transition: all 0.25s ease-in-out;
          }

          diff-area {
            * {
              display: none;

              white-space: pre-wrap;
            }

            ins {
              display: inline;
              color: green;
            }

            del {
              display: inline;
              color: red;
            }
          }
        }
      }
    }
    </style>
  </head>
  <body>
    <script src="dist/handler.min.js"></script>
    <script src="lib/mathbox-bundle.min.js"></script>

    <mathbox tabindex="2">
      <script type="mathbox/jsx">
        class Mass {
          constructor(mass, color, position = [0, 0, 0], velocity = [0, 0, 0], acceleration = [0, 0, 0], gravity = [0, 0, 0]) {
            this.mass = mass;
            this.color = color;
            this.position = position;
            this.velocity = velocity;
            this.acceleration = acceleration;
            this.gravity = gravity;
          }

          get size() { return 4 * Math.log(this.mass + 1) / 3; }

          positionHalfTick(ticksPerSecond) {
            const {position, velocity} = this;
            position[0] += velocity[0] / ticksPerSecond / 2;
            position[1] += velocity[1] / ticksPerSecond / 2;
            position[2] += velocity[2] / ticksPerSecond / 2;
          }
        }

        const universe = [
          new Mass(100000, [255, 255,   0, 0]),
          new Mass(100,    [  0,   0, 255, 1], [   1000,  0,   30],  [  0,  0.5,  200]),
          new Mass(100,    [255,   0, 255, 1], [   -1000,  0,  -30],  [  0,  0.5,  -200]),
          new Mass(0.015,  [255,   0,   0, 1], [ -15000,  0,  150], [ -5,    5,  317]),
          new Mass(0.25,   [255, 255, 255, 1], [ -15000,  0, -150], [  5,    5,  317]),
          new Mass(1000,   [0,   255, 255, 1], [ -15000,  0,   0],  [  0,   -1,  317])
        ];

        const trump = [[[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[1.00392,0.83137,0.8,1],[1.24706,0.97255,0.76078,1],[1.40392,1.11373,0.78431,1],[1.4902,1.21569,0.87059,1],[1.52941,1.26275,0.94118,1],[1.41961,1.19216,0.91765,1],[1.40392,1.21569,0.98039,1],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[0.94118,0.75294,0.77647,1],[1.30196,0.94118,0.61961,1],[1.41961,1.01961,0.63529,1],[1.41961,1.08235,0.73725,1],[1.41961,1.1451,0.80784,1],[1.45098,1.20784,0.91765,1],[1.4902,1.28627,1.01961,1],[1.48235,1.26275,0.98824,1],[1.47451,1.21569,0.92549,1],[1.43529,1.19216,0.88627,1],[1.46667,1.26275,0.97255,1],[1.48235,1.30196,1.05098,1],[1.34118,1.2549,1.17647,1],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[1.22353,0.86275,0.57255,1],[1.35686,0.94902,0.58039,1],[1.36471,0.95686,0.61176,1],[1.40392,1.03529,0.69804,1],[1.38824,1.10588,0.79216,1],[1.41176,1.17647,0.87843,1],[1.44314,1.19216,0.92549,1],[1.41961,1.16863,0.90196,1],[1.41961,1.11373,0.80784,1],[1.40392,1.06667,0.75294,1],[1.35686,1.06667,0.75294,1],[1.32549,1.01176,0.6902,1],[1.35686,1.0902,0.80784,1],[1.44314,1.23137,1.01961,1],[1.23137,1.09804,1.05098,1],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[1.1451,0.76863,0.47059,1],[1.32549,0.93333,0.54902,1],[1.34118,0.93333,0.54902,1],[1.34902,0.91765,0.54902,1],[1.38039,1.02745,0.70588,1],[1.36471,1.07451,0.77647,1],[1.33333,1.02745,0.71373,1],[1.3098,0.94902,0.63529,1],[1.33333,1.00392,0.69804,1],[1.36471,0.98039,0.68235,1],[1.34118,0.93333,0.63529,1],[1.32549,0.92549,0.61961,1],[1.35686,0.98824,0.6902,1],[1.38824,1.05098,0.76863,1],[1.46667,1.23922,1.01961,1],[1.42745,1.23137,1.03529,1],[1.12157,1.04314,1.04314,1],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[1.0902,0.71373,0.44706,1],[1.23137,0.80784,0.46275,1],[1.34902,0.91765,0.53333,1],[1.34118,0.91765,0.52549,1],[1.35686,0.95686,0.56471,1],[1.40392,1.05098,0.70588,1],[1.32549,0.95686,0.62745,1],[1.20784,0.79216,0.46275,1],[1.21569,0.80784,0.49412,1],[1.24706,0.83137,0.48627,1],[1.27843,0.84706,0.54118,1],[1.29412,0.83922,0.52549,1],[1.31765,0.86275,0.54118,1],[1.38824,0.96471,0.65882,1],[1.45098,1.09804,0.82353,1],[1.48235,1.16863,0.93333,1],[1.49804,1.28627,1.06667,1],[1.41961,1.22353,1.01176,1],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[0.90196,0.58824,0.42353,1],[1.08235,0.69804,0.38431,1],[1.20784,0.8,0.46275,1],[1.30196,0.87843,0.53333,1],[1.32549,0.88627,0.52549,1],[1.35686,0.91765,0.56471,1],[1.35686,0.90196,0.58039,1],[1.35686,0.89412,0.56471,1],[1.28627,0.82353,0.51765,1],[1.28627,0.79216,0.51765,1],[1.29412,0.78431,0.5098,1],[1.3098,0.81569,0.53333,1],[1.33333,0.8549,0.56471,1],[1.37255,0.90196,0.61176,1],[1.46667,1.05882,0.80784,1],[1.52941,1.16863,0.91765,1],[1.45882,1.11373,0.86275,1],[1.38824,1.05882,0.84706,1],[1.43529,1.18431,0.95686,1],[1.24706,1.06667,0.94902,1],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[0.95686,0.59608,0.36078,1],[1.24706,0.83137,0.53333,1],[1.29412,0.83137,0.50196,1],[1.27059,0.76078,0.41569,1],[1.2549,0.76078,0.41569,1],[1.30196,0.75294,0.42353,1],[1.36471,0.81569,0.50196,1],[1.38824,0.86275,0.57255,1],[1.37255,0.8549,0.57255,1],[1.37255,0.86275,0.58824,1],[1.41176,0.89412,0.62745,1],[1.42745,0.90196,0.63529,1],[1.38824,0.87843,0.61176,1],[1.38824,0.9098,0.64314,1],[1.43529,0.98039,0.71373,1],[1.52157,1.10588,0.8549,1],[1.46667,1.0902,0.8549,1],[1.40392,1.05098,0.83137,1],[1.34902,1.01176,0.8,1],[1.29412,1.06667,0.93333,1],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[0.58039,0.26667,0.20392,1],[0.8549,0.44706,0.25098,1],[1.1451,0.68235,0.4,1],[1.1451,0.65098,0.35294,1],[1.20784,0.65098,0.3451,1],[1.23137,0.65882,0.32941,1],[1.3098,0.71373,0.39216,1],[1.39608,0.78431,0.49412,1],[1.44314,0.83137,0.57255,1],[1.45882,0.84706,0.58824,1],[1.45882,0.88627,0.64314,1],[1.45882,0.9098,0.6902,1],[1.47451,0.91765,0.70588,1],[1.41961,0.87843,0.64314,1],[1.44314,0.87059,0.63529,1],[1.45882,0.90196,0.64314,1],[1.4902,0.96471,0.72941,1],[1.45882,0.96471,0.73725,1],[1.39608,0.96471,0.76863,1],[1.37255,1.02745,0.8549,1],[1.39608,1.16078,1.03529,1],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[0.65098,0.29804,0.24314,1],[1.00392,0.55686,0.35294,1],[1.12157,0.65098,0.38431,1],[1.15294,0.64314,0.40784,1],[1.24706,0.64314,0.36863,1],[1.33333,0.66667,0.36078,1],[1.36471,0.69804,0.4,1],[1.43529,0.73725,0.47059,1],[1.55294,0.83922,0.60392,1],[1.59216,0.86275,0.62745,1],[1.6,0.90196,0.6902,1],[1.58431,0.96471,0.80784,1],[1.56078,0.97255,0.81569,1],[1.52157,0.87843,0.69804,1],[1.59216,0.90196,0.71373,1],[1.55294,0.95686,0.75294,1],[1.52941,0.99608,0.78431,1],[1.45098,0.93333,0.72157,1],[1.45098,0.97255,0.77647,1],[1.42745,1.08235,0.92549,1],[1.45882,1.24706,1.11373,1],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[0.6902,0.31373,0.22745,1],[0.95686,0.51765,0.29804,1],[1.16078,0.68235,0.4549,1],[1.26275,0.70588,0.5098,1],[1.39608,0.72157,0.44706,1],[1.53725,0.83922,0.52549,1],[1.58431,0.88627,0.62745,1],[1.61569,0.9098,0.69804,1],[1.7098,1.00392,0.84706,1],[1.76471,1.01961,0.83137,1],[1.77255,1.08235,0.92549,1],[1.74902,1.11373,1.00392,1],[1.70196,1.12157,1.02745,1],[1.67843,1.08235,0.98039,1],[1.6549,1.06667,0.92549,1],[1.44314,0.98824,0.80784,1],[1.19216,0.80784,0.60392,1],[1.37255,0.99608,0.8,1],[1.56863,1.15294,0.94902,1],[1.43529,1.04314,0.88627,1],[1.40392,1.10588,0.95686,1],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[0.80784,0.42353,0.32157,1],[1.07451,0.65882,0.43137,1],[1.28627,0.87059,0.66667,1],[1.32549,0.80784,0.61176,1],[1.46667,0.8,0.53333,1],[1.63137,0.96471,0.70588,1],[1.6549,1.0902,0.87059,1],[1.6549,1.15294,0.97255,1],[1.74902,1.30196,1.16863,1],[1.77255,1.24706,1.12941,1],[1.80392,1.2549,1.16863,1],[1.79608,1.27059,1.22353,1],[1.81961,1.36471,1.31765,1],[1.82745,1.38824,1.30196,1],[1.58431,1.15294,1.06667,1],[1.23922,0.8549,0.77647,1],[1.38039,0.99608,0.93333,1],[1.57647,1.17647,1.0902,1],[1.61569,1.18431,1.02745,1],[1.46667,1.04314,0.89412,1],[1.33333,1.04314,0.9098,1],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[0.65882,0.30588,0.25098,1],[0.95686,0.61961,0.49412,1],[1.32549,0.97255,0.82353,1],[1.43529,0.93333,0.72941,1],[1.49804,0.86275,0.60392,1],[1.52157,0.89412,0.63529,1],[1.27843,0.76863,0.58039,1],[1.03529,0.54902,0.41569,1],[1.03529,0.56471,0.46275,1],[1.29412,0.81569,0.70588,1],[1.57647,1.06667,0.99608,1],[1.72549,1.12941,1.05882,1],[1.78824,1.19216,1.12157,1],[1.64706,1.13725,1.05882,1],[1.37255,0.94118,0.87059,1],[1.55294,1.15294,1.09804,1],[1.60784,1.09804,1.02745,1],[1.4902,0.93333,0.83922,1],[1.59216,1.1451,1.02745,1],[1.49804,1.07451,0.93333,1],[1.35686,1.0902,0.98039,1],[0.86275,0.67451,0.7451,1],[2,2,2,0]],
        [[2,2,2,0],[0.61961,0.26667,0.15686,1],[0.87843,0.55686,0.46275,1],[1.23922,0.8549,0.7451,1],[1.45098,0.87059,0.65882,1],[1.52157,0.87843,0.61176,1],[1.52157,0.92549,0.68235,1],[1.48235,0.93333,0.80784,1],[1.50588,0.91765,0.84706,1],[1.59216,1.08235,0.98824,1],[1.38824,0.94118,0.88627,1],[1.19216,0.66667,0.61176,1],[1.46667,0.84706,0.75294,1],[1.79608,1.18431,1.03529,1],[1.52941,1.05098,0.95686,1],[1.32549,0.88627,0.83137,1],[1.45882,0.99608,0.91765,1],[1.28627,0.93333,0.87843,1],[1.56863,1.16078,1.07451,1],[1.59216,1.2,1.08235,1],[1.6,1.12157,0.98039,1],[1.32549,0.98824,0.87059,1],[0.87843,0.55686,0.57255,1],[2,2,2,0]],
        [[2,2,2,0],[0.73725,0.32941,0.16471,1],[0.90196,0.5098,0.39216,1],[1.16078,0.6902,0.57255,1],[1.47451,0.82353,0.60392,1],[1.52157,0.82353,0.58039,1],[1.45098,0.84706,0.62745,1],[1.30196,0.71373,0.58039,1],[1.33333,0.70588,0.61961,1],[1.11373,0.72157,0.6902,1],[1.37255,1.00392,0.94902,1],[1.31765,0.83137,0.79216,1],[1.44314,0.8549,0.71373,1],[1.78824,1.15294,0.95686,1],[1.67843,1.15294,0.98824,1],[1.45882,0.93333,0.84706,1],[1.38039,0.98039,0.94118,1],[1.02745,0.84706,0.83137,1],[1.63137,1.27843,1.19216,1],[1.74118,1.41176,1.26275,1],[1.67059,1.18431,1.01176,1],[1.28627,0.91765,0.81569,1],[1.08235,0.70588,0.6902,1],[2,2,2,0]],
        [[2,2,2,0],[1.00392,0.51765,0.28235,1],[0.94118,0.48627,0.33725,1],[1.09804,0.63529,0.5098,1],[1.43529,0.79216,0.56471,1],[1.50588,0.76863,0.54118,1],[1.57647,0.97255,0.76078,1],[1.51373,1.05098,0.89412,1],[1.52157,1.01176,0.91765,1],[1.22353,0.88627,0.83137,1],[1.50588,1.18431,1.12941,1],[1.52941,1.03529,0.98824,1],[1.61569,0.96471,0.76863,1],[1.70196,1.01961,0.82353,1],[1.80392,1.27059,1.08235,1],[1.67059,1.18431,1.04314,1],[1.72549,1.31765,1.23922,1],[1.74118,1.35686,1.26275,1],[1.78824,1.41961,1.2549,1],[1.84314,1.49804,1.3098,1],[1.72549,1.24706,1.06667,1],[1.37255,0.92549,0.83922,1],[1.27059,0.92549,0.99608,1],[2,2,2,0]],
        [[2,2,2,0],[0.95686,0.54118,0.44706,1],[0.95686,0.46275,0.32157,1],[1.02745,0.54118,0.4549,1],[1.34902,0.73725,0.55686,1],[1.52941,0.80784,0.58039,1],[1.73333,1.12941,0.88627,1],[1.74118,1.2549,1.05098,1],[1.61569,1.0902,0.92549,1],[1.6,1.16078,1.03529,1],[1.60784,1.18431,1.11373,1],[1.66275,1.08235,0.97255,1],[1.63137,0.94118,0.77647,1],[1.64706,0.94902,0.77647,1],[1.84314,1.30196,1.13725,1],[1.74902,1.23922,1.0902,1],[1.75686,1.20784,1.04314,1],[1.87451,1.45098,1.29412,1],[1.86667,1.45098,1.27843,1],[1.83529,1.38039,1.2,1],[1.70196,1.16863,0.99608,1],[1.5451,1.10588,1.00392,1],[1.42745,1.12157,1.19216,1],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[1.10588,0.54902,0.36078,1],[0.99608,0.46275,0.36078,1],[1.27059,0.70588,0.56471,1],[1.52157,0.80784,0.55686,1],[1.68627,1.02745,0.77647,1],[1.82745,1.29412,1.03529,1],[1.81176,1.27843,1.03529,1],[1.84314,1.33333,1.12941,1],[1.81961,1.3098,1.16078,1],[1.74118,1.18431,1.01961,1],[1.52157,0.83137,0.62745,1],[1.63922,0.97255,0.80784,1],[1.85098,1.2549,1.11373,1],[1.69412,1.12941,1.01961,1],[1.78039,1.20784,1.06667,1],[1.88235,1.35686,1.21569,1],[1.85882,1.36471,1.23922,1],[1.73333,1.1451,0.98039,1],[1.6549,1.06667,0.92549,1],[1.67059,1.19216,1.06667,1],[1.55294,1.23137,1.23922,1],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[1.43529,0.69804,0.50196,1],[1.20784,0.55686,0.40784,1],[1.31765,0.72157,0.56471,1],[1.51373,0.81569,0.59608,1],[1.5451,0.79216,0.55686,1],[1.67843,0.95686,0.7451,1],[1.74902,1.10588,0.87843,1],[1.81961,1.24706,1.03529,1],[1.81176,1.26275,1.09804,1],[1.77255,1.17647,1.01961,1],[1.52941,0.8549,0.6902,1],[1.63922,1.03529,0.87843,1],[1.7098,1.1451,1.02745,1],[1.62353,1.12941,1.01961,1],[1.74902,1.16078,1.0902,1],[1.82745,1.30196,1.17647,1],[1.80392,1.26275,1.11373,1],[1.66275,1.04314,0.89412,1],[1.63137,1.01176,0.86275,1],[1.73333,1.26275,1.12157,1],[1.45882,1.2,1.23922,1],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[1.28627,0.8,0.86275,1],[1.71765,1.00392,0.72941,1],[1.55294,0.89412,0.66667,1],[1.53725,0.77647,0.57255,1],[1.52157,0.72941,0.53333,1],[1.45882,0.69804,0.50196,1],[1.53725,0.80784,0.61176,1],[1.68627,0.98039,0.78431,1],[1.74118,1.0902,0.91765,1],[1.73333,1.08235,0.94118,1],[1.38824,0.69804,0.57255,1],[1.00392,0.37647,0.25882,1],[1.23137,0.55686,0.43137,1],[1.23137,0.57255,0.48627,1],[1.74118,1.11373,1.04314,1],[1.78039,1.22353,1.11373,1],[1.76471,1.2,1.05882,1],[1.6549,1.02745,0.88627,1],[1.63137,0.98039,0.82353,1],[1.60784,1.06667,0.94118,1],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[1.78824,1.13725,0.89412,1],[1.6549,0.96471,0.72157,1],[1.53725,0.7451,0.52549,1],[1.57647,0.8,0.58039,1],[1.48235,0.72941,0.51765,1],[1.43529,0.6902,0.48627,1],[1.56863,0.8,0.61176,1],[1.7098,0.99608,0.77647,1],[1.74902,1.03529,0.8549,1],[1.63137,0.88627,0.70588,1],[1.41961,0.69804,0.5098,1],[1.6,0.98039,0.81569,1],[1.74902,1.16078,1.01176,1],[1.73333,1.07451,0.91765,1],[1.73333,1.12157,0.98039,1],[1.69412,1.05098,0.88627,1],[1.63137,1.00392,0.8549,1],[1.64706,1.01176,0.83922,1],[1.16863,0.73725,0.83922,1],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[1.38824,0.84706,0.90196,1],[1.70196,0.93333,0.6902,1],[1.49804,0.72941,0.49412,1],[1.5451,0.76863,0.53333,1],[1.49804,0.70588,0.48627,1],[1.45882,0.70588,0.4549,1],[1.47451,0.73725,0.5098,1],[1.56863,0.80784,0.55686,1],[1.72549,1.00392,0.77647,1],[1.68627,0.94902,0.72157,1],[1.7098,1.01176,0.80784,1],[1.78039,1.08235,0.99608,1],[1.78039,1.1451,1.05882,1],[1.74902,1.2,1.01961,1],[1.68627,1.04314,0.87843,1],[1.63922,0.96471,0.78431,1],[1.61569,1.00392,0.82353,1],[1.6549,0.98824,0.8,1],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[0.92549,0.42353,0.4,1],[1.43529,0.68235,0.50196,1],[1.4902,0.70588,0.5098,1],[1.45882,0.68235,0.4549,1],[1.45098,0.70588,0.44706,1],[1.43529,0.70588,0.4549,1],[1.41961,0.64314,0.41569,1],[1.46667,0.71373,0.47843,1],[1.6,0.91765,0.6902,1],[1.2,0.58039,0.47059,1],[0.46275,0.14118,0.16471,1],[0.54902,0.11765,0.12549,1],[1.52157,0.98039,0.87843,1],[1.63137,1.04314,0.89412,1],[1.6549,0.98824,0.78431,1],[1.63922,1.01961,0.8,1],[1.60784,0.95686,0.72941,1],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[1.35686,0.65098,0.48627,1],[1.32549,0.57255,0.37647,1],[1.43529,0.67451,0.43922,1],[1.49804,0.76863,0.51765,1],[1.55294,0.82353,0.58039,1],[1.56078,0.82353,0.55686,1],[1.47451,0.73725,0.47843,1],[1.36471,0.68235,0.5098,1],[0.93333,0.37647,0.37647,1],[0.44706,0.38431,0.38431,1],[0.65098,0.26667,0.2902,1],[1.38039,0.70588,0.69804,1],[1.55294,0.91765,0.79216,1],[1.66275,1.03529,0.80784,1],[1.63922,0.99608,0.76863,1],[1.61569,0.91765,0.66667,1],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[1.16078,0.57255,0.44706,1],[1.23922,0.52549,0.28235,1],[1.3098,0.58824,0.33725,1],[1.48235,0.73725,0.47843,1],[1.57647,0.83137,0.56471,1],[1.57647,0.80784,0.54118,1],[1.52941,0.75294,0.50196,1],[1.48235,0.65882,0.48627,1],[1.63137,0.69804,0.71373,1],[1.67059,0.73725,0.79216,1],[1.64706,0.60392,0.68235,1],[1.57647,0.84706,0.77647,1],[1.56863,0.83137,0.69804,1],[1.56078,0.88627,0.72941,1],[1.6,0.97255,0.77647,1],[1.56863,0.92549,0.65882,1],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[0.72157,0.4549,0.36863,1],[1.28627,0.54902,0.2902,1],[1.28627,0.56471,0.31373,1],[1.44314,0.6902,0.43137,1],[1.46667,0.71373,0.4549,1],[1.44314,0.68235,0.42353,1],[1.47451,0.65098,0.41569,1],[1.36471,0.54902,0.31373,1],[1.20784,0.43137,0.32157,1],[1.35686,0.63529,0.63529,1],[1.37255,0.66667,0.68235,1],[1.38824,0.65882,0.49412,1],[1.52157,0.78431,0.60392,1],[1.5451,0.87843,0.69804,1],[1.61569,0.98824,0.78431,1],[1.34118,0.80784,0.62745,1],[2,2,2,0],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[2,2,2,0],[2,2,2,0],[0,0,0.06275,1],[1.11373,1.04314,0.98039,1],[1.30196,0.70588,0.48627,1],[1.28627,0.57255,0.30588,1],[1.38039,0.64314,0.39216,1],[1.45882,0.7451,0.5098,1],[1.38824,0.67451,0.44706,1],[1.50588,0.72941,0.5098,1],[1.50588,0.70588,0.47843,1],[1.43529,0.70588,0.51765,1],[1.37255,0.76078,0.62745,1],[1.45098,0.83137,0.72157,1],[1.63137,0.94118,0.79216,1],[1.67843,1.00392,0.83137,1],[1.58431,0.98039,0.8,1],[1.49804,0.89412,0.69804,1],[1.09804,0.73725,0.63529,1],[0.28235,0.36078,0.55686,1],[2,2,2,0],[2,2,2,0]],
        [[2,2,2,0],[2,2,2,0],[0.26667,0.36863,0.64314,1],[0.23529,0.25098,0.3451,1],[0,0,0.02353,1],[1.26275,1.23137,1.16078,1],[1.66275,1.43529,1.3098,1],[1.09804,0.44706,0.21176,1],[1.22353,0.54118,0.32941,1],[1.31765,0.65882,0.4549,1],[1.30196,0.65098,0.46275,1],[1.35686,0.63529,0.43137,1],[1.64706,0.8549,0.65098,1],[1.67059,0.90196,0.7451,1],[1.72549,1.02745,0.90196,1],[1.71765,1.02745,0.87843,1],[1.68627,1.01961,0.87059,1],[1.63922,0.98039,0.81569,1],[1.38824,0.83922,0.65882,1],[1.21569,0.70588,0.52549,1],[1.46667,1.34902,1.3098,1],[0.29804,0.36078,0.52549,1],[0.29804,0.36863,0.54902,1],[2,2,2,0]],
        [[0.23529,0.35294,0.61176,1],[0.21961,0.30588,0.49412,1],[0.21176,0.26667,0.38431,1],[0.18039,0.18039,0.25882,1],[0.00784,0,0.04706,1],[1.16863,1.13725,1.08235,1],[1.93725,1.87451,1.79608,1],[1.45098,1.23922,1.12157,1],[0.94118,0.46275,0.2902,1],[1.05882,0.47843,0.33725,1],[1.16078,0.54118,0.40784,1],[1.0902,0.47843,0.3451,1],[1.23137,0.54902,0.39216,1],[1.43529,0.6902,0.52549,1],[1.51373,0.75294,0.64314,1],[1.48235,0.72157,0.63529,1],[1.30196,0.66667,0.57255,1],[1.08235,0.59608,0.50196,1],[0.94902,0.51765,0.39216,1],[1.24706,1.00392,0.93333,1],[1.79608,1.82745,1.82745,1],[0.27451,0.36078,0.52549,1],[0.25098,0.30588,0.47059,1],[0.30588,0.36078,0.52549,1]],
        [[0.18039,0.27451,0.46275,1],[0.20392,0.29804,0.47059,1],[0.21961,0.28235,0.43137,1],[0.17255,0.17255,0.27451,1],[0.03137,0.02353,0.12549,1],[1.03529,1.03529,0.99608,1],[2,1.97647,1.90588,1],[1.85098,1.81961,1.74118,1],[1.45098,1.34118,1.2549,1],[0.94118,0.62745,0.52549,1],[0.88627,0.41569,0.28235,1],[0.98039,0.44706,0.2902,1],[0.76863,0.33725,0.23529,1],[0.61961,0.21961,0.20392,1],[0.65882,0.23529,0.23529,1],[0.65882,0.22745,0.20392,1],[0.55686,0.26667,0.21961,1],[0.62745,0.32941,0.26667,1],[0.96471,0.76078,0.70588,1],[1.78824,1.81176,1.81961,1],[1.59216,1.64706,1.70196,1],[0.22745,0.28235,0.44706,1],[0.22745,0.25882,0.43137,1],[0.29804,0.33725,0.5098,1]],
        [[0.15686,0.22745,0.41569,1],[0.18039,0.25098,0.41569,1],[0.20392,0.26667,0.40784,1],[0.15686,0.17255,0.29804,1],[0.09412,0.08627,0.21176,1],[0.49412,0.48627,0.52549,1],[1.92157,1.89804,1.81176,1],[1.9451,1.91373,1.85098,1],[1.82745,1.81176,1.75686,1],[1.50588,1.50588,1.45882,1],[1.00392,0.83922,0.82353,1],[0.82353,0.52549,0.4549,1],[0.64314,0.26667,0.22745,1],[0.43922,0.10196,0.09412,1],[0.26667,0.00784,0.01569,1],[0.3451,0.04706,0.04706,1],[0.59608,0.29804,0.29804,1],[1.12157,1.01176,1.00392,1],[1.78039,1.84314,1.87451,1],[2,2,2,0],[1.10588,1.16078,1.2549,1],[0.13333,0.18039,0.35294,1],[0.18824,0.23529,0.39216,1],[0.26667,0.30588,0.47843,1]],
        [[0.13333,0.18824,0.36078,1],[0.15686,0.22745,0.38431,1],[0.16471,0.22745,0.39216,1],[0.13333,0.16471,0.29804,1],[0.07843,0.10196,0.21961,1],[0.13333,0.14902,0.27451,1],[1.68627,1.66275,1.58431,1],[1.88235,1.87451,1.81176,1],[1.92157,1.89804,1.84314,1],[1.81176,1.80392,1.74118,1],[1.66275,1.67059,1.61569,1],[1.37255,1.32549,1.29412,1],[0.98039,0.7451,0.7451,1],[0.4,0.08627,0.12549,1],[0.18824,0,0,1],[0.56471,0.4,0.43922,1],[1.45882,1.46667,1.51373,1],[1.90588,2,2,1],[1.97647,2,2,1],[2,2,2,0],[0.62745,0.6902,0.81569,1],[0.07843,0.14902,0.32157,1],[0.14902,0.19608,0.36863,1],[0.21961,0.26667,0.43922,1]]];

        const [
          positions,
          velocities,
          accelerations,
          gravities,
          masses,
          sizes,
          colors
        ] = map(universe, ['position', 'velocity', 'acceleration', 'gravity', 'mass', 'size', 'color']);

        function map(list, properties) {
          return properties.map(p => list.map(item => item[p]));
        }

        function addMass(newMass) {
          const {position, velocity, acceleration, gravity, mass, size, color} = newMass;

          universe.push(newMass);
          positions.push(position);
          velocities.push(velocity);
          accelerations.push(acceleration);
          gravities.push(gravity);
          masses.push(mass);
          sizes.push(size);
          colors.push(color);
        }

        <root>
          <camera proxy={true}
                  position={[0, 1, 10]}
                  lookAt={[0, 0, 0]}
                  up={[0, 1, 0]}
                  fov={100} />
          <spherical range={[[-500, 500], [-500, 500], [-500, 500]]}
                     scale={[1, 1, 1]}
                     bend={0}>

            <cartesian range={[[-1, 1], [-1, 1], [-1, 1]]}
                       scale={[trump[0].length * 10, trump.length * 10, trump.length * 10]}
                       position={t => universe[0].position}
                       rotation={[Math.PI, 0, 0]}>
              <area height={trump.length} width={trump[0].length} />
              <matrix id="trump"
                      width={trump[0].length}
                      height={trump.length}
                      data={trump} />
              <point points="<<" colors="<" size={20} shape="square" opacity={1}/>
            </cartesian>

            <array id="players"
                   width={universe.length}
                   channels={3}
                   history={1}
                   data={positions} />
            <array id="colors"
                   width={universe.length}
                   channels={4}
                   data={colors} />
            <array id="sizes"
                   width={universe.length}
                   channels={1}
                   data={sizes} />
            <point points="<<<" colors="<<" sizes="<" shape="circle" opacity={0.9}/>

            <array id="velocities"
                   width={velocities.length}
                   channels={3}
                   items={2}
                   expr={(emit, x, i, t) => {
                     emit(...positions[x]);
                     emit(positions[x][0] + velocities[x][0],
                          positions[x][1] + velocities[x][1],
                          positions[x][2] + velocities[x][2]);
                   }} />
            <vector size={1} points="<" color={0xCCCCFF} width={1} end={true} opacity={0.7} />

            <array id="gravities"
                   width={gravities.length}
                   channels={3}
                   items={2}
                   expr={(emit, x, i, t) => {
                     emit(...positions[x]);
                     emit(positions[x][0] + gravities[x][0],
                          positions[x][1] + gravities[x][1],
                          positions[x][2] + gravities[x][2]);
                   }} />
            <vector size={1} points="<" color={0xCCFFCC} width={1} end={true} opacity={0.9} />
          </spherical>
        </root>

        let ticksPerStep = 1,
            stepsPerSecond = 60,
            ticksPerSecond = stepsPerSecond * ticksPerStep;

        setInterval(step, 1000 / stepsPerSecond);

        let currentStep = 0;
        function step() {
          for (let i = 0; i < ticksPerStep; i++) tick();
          currentStep++;
        }

        function updatePair(item1, item2) {
          const {
            position: p1,
            velocity: v1,
            acceleration: a1,
            gravity: g1,
            mass: m1,
            size: s1
          } = item1;

          const {
            position: p2,
            velocity: v2,
            acceleration: a2,
            gravity: g2,
            mass: m2,
            size: s2
          } = item2;

        }

        let currentTick = 0;
        function tick() {
          currentTick++;

          universe.map(u => u.positionHalfTick(ticksPerSecond));

        //  for (let i = 0; i < universe.length; i++) positionHalfTick(universe[i]);

          for (let i = 0; i < universe.length; i++) {
            const {
              position,
              velocity,
              acceleration,
              gravity,
              mass,
              size
            } = universe[i];

            gravity[0] = 0;
            gravity[1] = 0;
            gravity[2] = 0;

            // can be optimized quite a bit?
            const collapseList = [];
            const pullVector = [0, 0, 0],
                  oldOtherPosition = [0, 0, 0],
                  difference = [0, 0, 0];
            const speedlimit = 300000;
            for (let j = i + 1; j < universe.length; j++) updatePair(universe[i], universe[j]);

            for (let j = 0; j < universe.length; j++) {
              if (i === j) continue;

              const {
                position: otherPosition,
                velocity: otherVelocity,
                acceleration: otherAcceleration,
                mass: otherMass,
                size: otherSize
              } = universe[j];

              difference[0] = position[0] - otherPosition[0];
              difference[1] = position[1] - otherPosition[1];
              difference[2] = position[2] - otherPosition[2];

              const time = -magnitude(difference) / (speedlimit * speedlimit),
                    offset = time / ticksPerSecond; // 0; //time - (ticksPerSecond/1000);

              oldOtherPosition[0] = otherPosition[0] + offset * (otherVelocity[0] + (otherVelocity[0] + offset * (otherAcceleration[0] /*+ gravity[0]*/)) / 2);
              oldOtherPosition[1] = otherPosition[1] + offset * (otherVelocity[1] + (otherVelocity[1] + offset * (otherAcceleration[1] /*+ gravity[1]*/)) / 2);
              oldOtherPosition[2] = otherPosition[2] + offset * (otherVelocity[2] + (otherVelocity[2] + offset * (otherAcceleration[2] /*+ gravity[2]*/)) / 2);

              pullVector[0] = oldOtherPosition[0] - position[0];
              pullVector[1] = oldOtherPosition[1] - position[1];
              pullVector[2] = oldOtherPosition[2] - position[2];

              const distance = magnitude(pullVector);

              // could handle collisions here?

              if (distance > 0) {
                const factor = (mass * otherMass) / (distance * distance);
                gravity[0] += pullVector[0] * factor;
                gravity[1] += pullVector[1] * factor;
                gravity[2] += pullVector[2] * factor;
              }
            }

            // F = ma ... a = F/m
            gravity[0] = gravity[0] / mass;
            gravity[1] = gravity[1] / mass;
            gravity[2] = gravity[2] / mass;
          }

          for (let i = 0; i < universe.length; i++) {
            const {
              position,
              velocity,
              acceleration,
              gravity
            } = universe[i];

            velocity[0] += (acceleration[0] + gravity[0]) / ticksPerSecond;
            velocity[1] += (acceleration[1] + gravity[1]) / ticksPerSecond;
            velocity[2] += (acceleration[2] + gravity[2]) / ticksPerSecond;

            universe[i].positionHalfTick(ticksPerSecond);
          }
        }

        function magnitude(vector) {
          return Math.sqrt(vector[0] * vector[0] +
                           vector[1] * vector[1] +
                           vector[2] * vector[2]);
        }

        let selectedMassIndex = 0, savedColor = [0, 0, 0];
        selectMass(selectedMassIndex);

        module.exports = {
          editorPanel: true,
          plugins: ['core', 'controls', 'cursor'],
          controls: [
            [['A'], 'left'],
            [['D'], 'right'],
            [['W'], 'forward'],
            [['S'], 'backward'],
            [['Q'], 'up'],
            [['Z'], 'down'],
            [['H'], 'toggleHistory'],
            [[190], 'speedUp'],
            [[188], 'slowDown'],
            [[32], 'changePlayer'],
            [[13], 'newMass']
          ],
          commands: {
            'left': () => velocities[selectedMassIndex][0]--,
            'right': () => velocities[selectedMassIndex][0]++,
            'forward': () => velocities[selectedMassIndex][2]--,
            'backward': () => velocities[selectedMassIndex][2]++,
            'up': () => velocities[selectedMassIndex][1]++,
            'down': () => velocities[selectedMassIndex][1]--,
            'toggleHistory': {
              '#players': {
                'history'() {
                  // doesn't work :(
                  return 1;
                }
              }
            },
            'speedUp': () => ticksPerStep++,
            'slowDown': () => ticksPerStep = Math.max(1, --ticksPerStep),
            'changePlayer'() {
              unselectMass(selectedMassIndex);
              (selectedMassIndex = (selectedMassIndex + 1) % positions.length);
              selectMass(selectedMassIndex);
            },
            'newMass': {
              '#players': {
                'width'() {
                  addMass(new Mass(1, [255, 0, 0, 1], [Math.random() * 1600 - 800, Math.random() * 1600 - 800, Math.random() * 1600 - 800], [Math.random() * 600 - 300, Math.random() * 600 - 300, Math.random() * 600 - 300]));
                  return universe.length;
                }
              },
              '#colors': {
                'width'() { return universe.length; }
              },
              '#velocities': {
                'width'() { return universe.length; }
              },
              '#sizes': {
                'width'() { return universe.length; }
              }
            }
          }
        };

        function unselectMass(selectedMassIndex) {
          colors[selectedMassIndex][0] = savedColor[0];
          colors[selectedMassIndex][1] = savedColor[1];
          colors[selectedMassIndex][2] = savedColor[2];
        }

        function selectMass(selectedMassIndex) {
          savedColor[0] = colors[selectedMassIndex][0];
          savedColor[1] = colors[selectedMassIndex][1];
          savedColor[2] = colors[selectedMassIndex][2];
          colors[selectedMassIndex][0] = 0;
          colors[selectedMassIndex][1] = 255;
          colors[selectedMassIndex][2] = 0;
        }
      </script>
    </mathbox>
  </body>
</html>
